
require:
   ..channel -> Channel


redirect(path, new-path, m) =
   (({original-path = path} & m) & {path = new-path}) &
      if path.starts-with(new-path):
         {sub-path = path[(new-path.length + 1)...]}
      else:
         {=}


jsclass RedirectChannel < Channel:
   dispatch(m) =
      @master.dispatch with
         redirect(@path, @options.redirect-path, m)


provide:
   {redirect = RedirectChannel} as channels
   {=} as components
